{"remainingRequest":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\_codes\\MyProjects\\vuetestbs\\src\\components\\Draw.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\_codes\\MyProjects\\vuetestbs\\src\\components\\Draw.vue","mtime":1611985416431},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJEcmF3IiwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgd2lkdGg6IDEyODAsDQogICAgICBoZWlnaHQ6IDYyMCwNCiAgICAgIHJlY3Q6IFtdLA0KICAgICAgY2FudmFzOiB7fSwNCiAgICAgIHNob3dNZW51OiBmYWxzZSwNCiAgICAgIHg6ICIiLA0KICAgICAgeTogIiIsDQogICAgICBtb3VzZUZyb206IHt9LA0KICAgICAgbW91c2VUbzoge30sDQogICAgICBkcmF3VHlwZTogbnVsbCwgIC8v5b2T5YmN57uY5Yi25Zu+5YOP55qE56eN57G7DQogICAgICBjYW52YXNPYmplY3RJbmRleDogMCwNCiAgICAgIHRleHRib3g6IG51bGwsDQogICAgICByZWN0YW5nbGVMYWJlbDogIndhcm5pbmciLA0KICAgICAgZHJhd1dpZHRoOiAyLCAvL+eslOinpuWuveW6pg0KICAgICAgY29sb3I6ICIjRTM0RjUxIiwgLy/nlLvnrJTpopzoibINCiAgICAgIGRyYXdpbmdPYmplY3Q6IG51bGwsIC8v5b2T5YmN57uY5Yi25a+56LGhDQogICAgICBtb3ZlQ291bnQ6IDEsIC8v57uY5Yi256e75Yqo6K6h5pWw5ZmoDQogICAgICBkb0RyYXdpbmc6IGZhbHNlLCAvLyDnu5jliLbnirbmgIENCiAgICAgIC8vcG9seWdvbiDnm7jlhbPlj4LmlbANCiAgICAgIHBvbHlnb25Nb2RlOiBmYWxzZSwNCiAgICAgIHBvaW50QXJyYXk6IFtdLA0KICAgICAgbGluZUFycmF5OiBbXSwNCiAgICAgIGFjdGl2ZVNoYXBlOiBmYWxzZSwNCiAgICAgIGFjdGl2ZUxpbmU6ICIiLA0KICAgICAgbGluZToge30sDQogICAgICBkZWxlY3RLbGFzczoge30sDQogICAgICBpbWdGaWxlOiB7fSwNCiAgICAgIGltZ1NyYzogIiIsDQogICAgfTsNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBkcmF3VHlwZSgpIHsNCiAgICAgIHRoaXMuY2FudmFzLnNlbGVjdGlvbiA9ICF0aGlzLmRyYXdUeXBlOw0KICAgIH0sDQogICAgd2lkdGgoKSB7DQogICAgICB0aGlzLmNhbnZhcy5zZXRXaWR0aCh0aGlzLndpZHRoKQ0KICAgIH0sDQogICAgaGVpZ2h0KCkgew0KICAgICAgdGhpcy5jYW52YXMuc2V0SGVpZ2h0KHRoaXMuaGVpZ2h0KQ0KICAgIH0sDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDkv53lrZjlvZPliY3nlLvluIPkuLpwbmflm77niYcNCiAgICBzYXZlKCkgew0KICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKQ0KICAgICAgdmFyIGltZ0RhdGEgPSBjYW52YXMudG9EYXRhVVJMKCdwbmcnKTsNCiAgICAgIGltZ0RhdGEgPSBpbWdEYXRhLnJlcGxhY2UoJ2ltYWdlL3BuZycsICdpbWFnZS9vY3RldC1zdHJlYW0nKTsNCiAgICAgIC8vIOS4i+i9veWQjueahOmXrumimOWQje+8jOWPr+iHqueUseaMh+Wumg0KICAgICAgdmFyIGZpbGVuYW1lID0gJ2RyYXdpbmdib2FyZF8nICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArICcuJyArICdwbmcnOw0KICAgICAgdGhpcy5zYXZlRmlsZShpbWdEYXRhLCBmaWxlbmFtZSk7DQogICAgfSwNCiAgICBzYXZlRmlsZShkYXRhLCBmaWxlbmFtZSkgew0KICAgICAgdmFyIHNhdmVfbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCiAgICAgIHNhdmVfbGluay5ocmVmID0gZGF0YTsNCiAgICAgIHNhdmVfbGluay5kb3dubG9hZCA9IGZpbGVuYW1lOw0KICAgICAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7DQogICAgICBldmVudC5pbml0TW91c2VFdmVudCgnY2xpY2snLCB0cnVlLCBmYWxzZSwgd2luZG93LCAwLCAwLCAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7DQogICAgICBzYXZlX2xpbmsuZGlzcGF0Y2hFdmVudChldmVudCk7DQogICAgfSwNCiAgICB1cGxvYWRJbWcoKSB7DQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1nSW5wdXQiKS5jbGljaygpOw0KICAgIH0sDQogICAgLy8g5LuO5bey5riy5p+T55qERE9N5YWD57Sg5Yqg6L295Zu+54mH6IezY2FudmFzDQogICAgbG9hZEV4cEltZygpIHsNCiAgICAgIHZhciBpbWdFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImV4cEltZyIpOyAvL+WjsOaYjuaIkeS7rOeahOWbvueJhw0KICAgICAgdmFyIGltZ0luc3RhbmNlID0gbmV3IGZhYnJpYy5JbWFnZShpbWdFbGVtZW50LCB7DQogICAgICAgIHNlbGVjdGFibGU6IGZhbHNlDQogICAgICAgIC8vIHpJbmRleDotOTksDQogICAgICB9KTsNCiAgICAgIHRoaXMuY2FudmFzLmFkZChpbWdJbnN0YW5jZSk7DQogICAgfSwNCiAgICAvLyDku47mlofku7bliqDovb3lm77niYfoh7NjYW52YXMNCiAgICB1cGxvYWRJbWdDaGFuZ2UoKSB7DQogICAgICAvLyDojrflj5bmlofku7YNCiAgICAgIHZhciBlbGVJbXBvcnRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWdJbnB1dCIpOw0KICAgICAgdGhpcy5pbWdGaWxlID0gZWxlSW1wb3J0SW5wdXQuZmlsZXNbMF07DQogICAgICB2YXIgaW1nU3JjID0gIiIsDQogICAgICAgICAgaW1nVGl0bGUgPSAiIjsNCiAgICAgIC8vIOS7jnJlYWRlcuS4reiOt+WPlumAieaLqeaWh+S7tueahHNyYw0KICAgICAgaWYgKC9cLihqcGU/Z3xwbmd8Z2lmKSQvaS50ZXN0KHRoaXMuaW1nRmlsZS5uYW1lKSkgew0KICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgdmFyIF90aGlzID0gdGhpczsNCiAgICAgICAgcmVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoDQogICAgICAgICAgICAibG9hZCIsDQogICAgICAgICAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIGltZ1RpdGxlID0gX3RoaXMuaW1nRmlsZS5uYW1lOw0KICAgICAgICAgICAgICBfdGhpcy5pbWdTcmMgPSB0aGlzLnJlc3VsdDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBmYWxzZQ0KICAgICAgICApOw0KICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCh0aGlzLmltZ0ZpbGUpOw0KICAgICAgfQ0KICAgICAgdmFyIGltZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW1nIik7IC8v5aOw5piO5oiR5Lus55qE5Zu+54mHDQogICAgICBpbWdFbGVtZW50Lm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgdGhpcy53aWR0aCA9IGltZ0VsZW1lbnQud2lkdGgNCiAgICAgICAgdGhpcy5oZWlnaHQgPSBpbWdFbGVtZW50LmhlaWdodA0KICAgICAgICB2YXIgaW1nSW5zdGFuY2UgPSBuZXcgZmFicmljLkltYWdlKGltZ0VsZW1lbnQsIHsNCiAgICAgICAgICB6SW5kZXg6IC0xLA0KICAgICAgICAgIHNlbGVjdGFibGU6IGZhbHNlDQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNhbnZhcy5hZGQoaW1nSW5zdGFuY2UpOw0KICAgICAgfTsNCiAgICB9LA0KICAgIC8vIOW8gOWni+e7mOWItuaXtu+8jOaMh+Wumue7mOeUu+enjeexuw0KICAgIGRyYXdUeXBlQ2hhbmdlKGUpIHsNCiAgICAgIHRoaXMuZHJhd1R5cGUgPSBlOw0KICAgICAgdGhpcy5jYW52YXMuc2tpcFRhcmdldEZpbmQgPSAhIWUNCiAgICAgIGlmIChlID09ICJwZW4iKSB7DQogICAgICAgIC8vIGlzRHJhd2luZ01vZGXkuLp0cnVlIOaJjeWPr+S7peiHqueUsee7mOeUuw0KICAgICAgICB0aGlzLmNhbnZhcy5pc0RyYXdpbmdNb2RlID0gdHJ1ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuY2FudmFzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOm8oOagh+aMieS4i+aXtuinpuWPkQ0KICAgIG1vdXNlZG93bihlKSB7DQogICAgICAvLyDorrDlvZXpvKDmoIfmjInkuIvml7bnmoTlnZDmoIcNCiAgICAgIHZhciB4eSA9IGUucG9pbnRlciB8fCB0aGlzLnRyYW5zZm9ybU1vdXNlKGUuZS5vZmZzZXRYLCBlLmUub2Zmc2V0WSk7DQogICAgICB0aGlzLm1vdXNlRnJvbS54ID0geHkueDsNCiAgICAgIHRoaXMubW91c2VGcm9tLnkgPSB4eS55Ow0KICAgICAgdGhpcy5kb0RyYXdpbmcgPSB0cnVlOw0KICAgICAgaWYgKHRoaXMuZHJhd1R5cGUgPT0gInRleHQiKSB7DQogICAgICAgIHRoaXMuZHJhd2luZygpOw0KICAgICAgfQ0KICAgICAgaWYgKHRoaXMudGV4dGJveCkgew0KICAgICAgICB0aGlzLnRleHRib3guZW50ZXJFZGl0aW5nKCk7DQogICAgICAgIHRoaXMudGV4dGJveC5oaWRkZW5UZXh0YXJlYS5mb2N1cygpOw0KICAgICAgfQ0KICAgICAgLy8g57uY5Yi25aSa6L655b2iDQogICAgICBpZiAodGhpcy5kcmF3VHlwZSA9PSAicG9seWdvbiIpIHsNCiAgICAgICAgdGhpcy5jYW52YXMuc2tpcFRhcmdldEZpbmQgPSBmYWxzZTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAvLyDmraTmrrXkuLrliKTmlq3mmK/lkKbpl63lkIjlpJrovrnlvaLvvIzngrnlh7vnuqLngrnml7bpl63lkIjlpJrovrnlvaINCiAgICAgICAgICBpZiAodGhpcy5wb2ludEFycmF5Lmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIC8vIGUudGFyZ2V0LmlkID09IHRoaXMucG9pbnRBcnJheVswXS5pZCDooajnpLrngrnlh7vkuobliJ3lp4vnuqLngrkNCiAgICAgICAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5pZCA9PSB0aGlzLnBvaW50QXJyYXlbMF0uaWQpIHsNCiAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZVBvbHlnb24oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgLy/mnKrngrnlh7vnuqLngrnliJnnu6fnu63kvZznlLsNCiAgICAgICAgICBpZiAodGhpcy5wb2x5Z29uTW9kZSkgew0KICAgICAgICAgICAgdGhpcy5hZGRQb2ludChlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICAvLyDpvKDmoIfmnb7lvIDmiafooYwNCiAgICBtb3VzZXVwKGUpIHsNCiAgICAgIHZhciB4eSA9IGUucG9pbnRlciB8fCB0aGlzLnRyYW5zZm9ybU1vdXNlKGUuZS5vZmZzZXRYLCBlLmUub2Zmc2V0WSk7DQogICAgICB0aGlzLm1vdXNlVG8ueCA9IHh5Lng7DQogICAgICB0aGlzLm1vdXNlVG8ueSA9IHh5Lnk7DQogICAgICB0aGlzLmRyYXdpbmdPYmplY3QgPSBudWxsOw0KICAgICAgdGhpcy5tb3ZlQ291bnQgPSAxOw0KICAgICAgaWYgKHRoaXMuZHJhd1R5cGUgIT0gInBvbHlnb24iKSB7DQogICAgICAgIHRoaXMuZG9EcmF3aW5nID0gZmFsc2U7DQogICAgICB9DQogICAgfSwNCiAgICAvL+m8oOagh+enu+WKqOi/h+eoi+S4reW3sue7j+WujOaIkOS6hue7mOWItg0KICAgIG1vdXNlbW92ZShlKSB7DQogICAgICBpZiAodGhpcy5tb3ZlQ291bnQgJSAyICYmICF0aGlzLmRvRHJhd2luZykgew0KICAgICAgICAvL+WHj+Wwkee7mOWItumikeeOhw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICB0aGlzLm1vdmVDb3VudCsrOw0KICAgICAgdmFyIHh5ID0gZS5wb2ludGVyIHx8IHRoaXMudHJhbnNmb3JtTW91c2UoZS5lLm9mZnNldFgsIGUuZS5vZmZzZXRZKTsNCiAgICAgIHRoaXMubW91c2VUby54ID0geHkueDsNCiAgICAgIHRoaXMubW91c2VUby55ID0geHkueTsNCiAgICAgIC8vIOWkmui+ueW9ouS4juaWh+Wtl+ahhueJueauiuWkhOeQhg0KICAgICAgaWYgKHRoaXMuZHJhd1R5cGUgIT0gInRleHQiIHx8IHRoaXMuZHJhd1R5cGUgIT0gInBvbHlnb24iKSB7DQogICAgICAgIHRoaXMuZHJhd2luZyhlKTsNCiAgICAgIH0NCiAgICAgIGlmICh0aGlzLmRyYXdUeXBlID09ICJwb2x5Z29uIikgew0KICAgICAgICBpZiAodGhpcy5hY3RpdmVMaW5lICYmIHRoaXMuYWN0aXZlTGluZS5jbGFzcyA9PSAibGluZSIpIHsNCiAgICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuY2FudmFzLmdldFBvaW50ZXIoZS5lKTsNCiAgICAgICAgICB0aGlzLmFjdGl2ZUxpbmUuc2V0KHsgeDI6IHBvaW50ZXIueCwgeTI6IHBvaW50ZXIueSB9KTsNCiAgICAgICAgICB2YXIgcG9pbnRzID0gdGhpcy5hY3RpdmVTaGFwZS5nZXQoInBvaW50cyIpOw0KICAgICAgICAgIHBvaW50c1t0aGlzLnBvaW50QXJyYXkubGVuZ3RoXSA9IHsNCiAgICAgICAgICAgIHg6IHBvaW50ZXIueCwNCiAgICAgICAgICAgIHk6IHBvaW50ZXIueSwNCiAgICAgICAgICAgIHpJbmRleDogMQ0KICAgICAgICAgIH07DQogICAgICAgICAgdGhpcy5hY3RpdmVTaGFwZS5zZXQoew0KICAgICAgICAgICAgcG9pbnRzOiBwb2ludHMNCiAgICAgICAgICB9KTsNCiAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGRlbGV0ZU9iaigpIHsNCiAgICAgIHRoaXMuY2FudmFzLmdldEFjdGl2ZU9iamVjdHMoKS5tYXAoaXRlbSA9PiB7DQogICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZShpdGVtKTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgdHJhbnNmb3JtTW91c2UobW91c2VYLCBtb3VzZVkpIHsNCiAgICAgIHJldHVybiB7IHg6IG1vdXNlWCAvIDEsIHk6IG1vdXNlWSAvIDEgfTsNCiAgICB9LA0KICAgIC8vIOe7mOWItuWkmui+ueW9ouW8gOWni++8jOe7mOWItuWkmui+ueW9ouWSjOWFtuS7luWbvuW9ouS4jeS4gOagt++8jOmcgOimgeWNleeLrOWkhOeQhg0KICAgIGRyYXdQb2x5Z29uKCkgew0KICAgICAgdGhpcy5kcmF3VHlwZSA9ICJwb2x5Z29uIjsNCiAgICAgIHRoaXMucG9seWdvbk1vZGUgPSB0cnVlOw0KICAgICAgLy/ov5nph4znlLvnmoTlpJrovrnlvaLvvIznlLHpobbngrnkuI7nur/nu4TmiJANCiAgICAgIHRoaXMucG9pbnRBcnJheSA9IG5ldyBBcnJheSgpOyAgLy8g6aG254K56ZuG5ZCIDQogICAgICB0aGlzLmxpbmVBcnJheSA9IG5ldyBBcnJheSgpOyAgLy/nur/pm4blkIgNCiAgICAgIHRoaXMuY2FudmFzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTsNCiAgICB9LA0KICAgIGFkZFBvaW50KGUpIHsNCiAgICAgIHZhciByYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCk7DQogICAgICB2YXIgaWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIHJhbmRvbTsNCiAgICAgIHZhciBjaXJjbGUgPSBuZXcgZmFicmljLkNpcmNsZSh7DQogICAgICAgIHJhZGl1czogNSwNCiAgICAgICAgZmlsbDogIiNmZmZmZmYiLA0KICAgICAgICBzdHJva2U6ICIjMzMzMzMzIiwNCiAgICAgICAgc3Ryb2tlV2lkdGg6IDAuNSwNCiAgICAgICAgbGVmdDogKGUucG9pbnRlci54IHx8IGUuZS5sYXllclgpIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpLA0KICAgICAgICB0b3A6IChlLnBvaW50ZXIueSB8fCBlLmUubGF5ZXJZKSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSwNCiAgICAgICAgc2VsZWN0YWJsZTogZmFsc2UsDQogICAgICAgIGhhc0JvcmRlcnM6IGZhbHNlLA0KICAgICAgICBoYXNDb250cm9sczogZmFsc2UsDQogICAgICAgIG9yaWdpblg6ICJjZW50ZXIiLA0KICAgICAgICBvcmlnaW5ZOiAiY2VudGVyIiwNCiAgICAgICAgaWQ6IGlkLA0KICAgICAgICBvYmplY3RDYWNoaW5nOiBmYWxzZQ0KICAgICAgfSk7DQogICAgICBpZiAodGhpcy5wb2ludEFycmF5Lmxlbmd0aCA9PSAwKSB7DQogICAgICAgIGNpcmNsZS5zZXQoew0KICAgICAgICAgIGZpbGw6ICJyZWQiDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgdmFyIHBvaW50cyA9IFsNCiAgICAgICAgKGUucG9pbnRlci54IHx8IGUuZS5sYXllclgpIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpLA0KICAgICAgICAoZS5wb2ludGVyLnkgfHwgZS5lLmxheWVyWSkgLyB0aGlzLmNhbnZhcy5nZXRab29tKCksDQogICAgICAgIChlLnBvaW50ZXIueCB8fCBlLmUubGF5ZXJYKSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSwNCiAgICAgICAgKGUucG9pbnRlci55IHx8IGUuZS5sYXllclkpIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpDQogICAgICBdOw0KICAgICAgdGhpcy5saW5lID0gbmV3IGZhYnJpYy5MaW5lKHBvaW50cywgew0KICAgICAgICBzdHJva2VXaWR0aDogMiwNCiAgICAgICAgZmlsbDogIiM5OTk5OTkiLA0KICAgICAgICBzdHJva2U6ICIjOTk5OTk5IiwNCiAgICAgICAgY2xhc3M6ICJsaW5lIiwNCiAgICAgICAgb3JpZ2luWDogImNlbnRlciIsDQogICAgICAgIG9yaWdpblk6ICJjZW50ZXIiLA0KICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSwNCiAgICAgICAgaGFzQm9yZGVyczogZmFsc2UsDQogICAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSwNCiAgICAgICAgZXZlbnRlZDogZmFsc2UsDQogICAgICAgIG9iamVjdENhY2hpbmc6IGZhbHNlDQogICAgICB9KTsNCiAgICAgIGlmICh0aGlzLmFjdGl2ZVNoYXBlKSB7DQogICAgICAgIHZhciBwb3MgPSB0aGlzLmNhbnZhcy5nZXRQb2ludGVyKGUuZSk7DQogICAgICAgIHZhciBwb2ludHMgPSB0aGlzLmFjdGl2ZVNoYXBlLmdldCgicG9pbnRzIik7DQogICAgICAgIHBvaW50cy5wdXNoKHsNCiAgICAgICAgICB4OiBwb3MueCwNCiAgICAgICAgICB5OiBwb3MueQ0KICAgICAgICB9KTsNCiAgICAgICAgdmFyIHBvbHlnb24gPSBuZXcgZmFicmljLlBvbHlnb24ocG9pbnRzLCB7DQogICAgICAgICAgc3Ryb2tlOiAiIzMzMzMzMyIsDQogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsDQogICAgICAgICAgZmlsbDogIiNjY2NjY2MiLA0KICAgICAgICAgIG9wYWNpdHk6IDAuMywNCiAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSwNCiAgICAgICAgICBoYXNCb3JkZXJzOiBmYWxzZSwNCiAgICAgICAgICBoYXNDb250cm9sczogZmFsc2UsDQogICAgICAgICAgZXZlbnRlZDogZmFsc2UsDQogICAgICAgICAgb2JqZWN0Q2FjaGluZzogZmFsc2UNCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLmFjdGl2ZVNoYXBlKTsNCiAgICAgICAgdGhpcy5jYW52YXMuYWRkKHBvbHlnb24pOw0KICAgICAgICB0aGlzLmFjdGl2ZVNoYXBlID0gcG9seWdvbjsNCiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgcG9seVBvaW50ID0gWw0KICAgICAgICAgIHsNCiAgICAgICAgICAgIHg6IChlLnBvaW50ZXIueCB8fCBlLmUubGF5ZXJYKSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSwNCiAgICAgICAgICAgIHk6IChlLnBvaW50ZXIueSB8fCBlLmUubGF5ZXJZKSAvIHRoaXMuY2FudmFzLmdldFpvb20oKQ0KICAgICAgICAgIH0NCiAgICAgICAgXTsNCiAgICAgICAgdmFyIHBvbHlnb24gPSBuZXcgZmFicmljLlBvbHlnb24ocG9seVBvaW50LCB7DQogICAgICAgICAgc3Ryb2tlOiAiIzMzMzMzMyIsDQogICAgICAgICAgc3Ryb2tlV2lkdGg6IDEsDQogICAgICAgICAgZmlsbDogIiNjY2NjY2MiLA0KICAgICAgICAgIG9wYWNpdHk6IDAuMywNCiAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSwNCiAgICAgICAgICBoYXNCb3JkZXJzOiBmYWxzZSwNCiAgICAgICAgICBoYXNDb250cm9sczogZmFsc2UsDQogICAgICAgICAgZXZlbnRlZDogZmFsc2UsDQogICAgICAgICAgb2JqZWN0Q2FjaGluZzogZmFsc2UNCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuYWN0aXZlU2hhcGUgPSBwb2x5Z29uOw0KICAgICAgICB0aGlzLmNhbnZhcy5hZGQocG9seWdvbik7DQogICAgICB9DQogICAgICB0aGlzLmFjdGl2ZUxpbmUgPSB0aGlzLmxpbmU7DQogICAgICB0aGlzLnBvaW50QXJyYXkucHVzaChjaXJjbGUpOw0KICAgICAgdGhpcy5saW5lQXJyYXkucHVzaCh0aGlzLmxpbmUpOw0KICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMubGluZSk7DQogICAgICB0aGlzLmNhbnZhcy5hZGQoY2lyY2xlKTsNCiAgICB9LA0KICAgIGdlbmVyYXRlUG9seWdvbigpIHsNCiAgICAgIHZhciBwb2ludHMgPSBuZXcgQXJyYXkoKTsNCiAgICAgIHRoaXMucG9pbnRBcnJheS5tYXAoKHBvaW50LCBpbmRleCkgPT4gew0KICAgICAgICBwb2ludHMucHVzaCh7DQogICAgICAgICAgeDogcG9pbnQubGVmdCwNCiAgICAgICAgICB5OiBwb2ludC50b3ANCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZShwb2ludCk7DQogICAgICB9KTsNCiAgICAgIHRoaXMubGluZUFycmF5Lm1hcCgobGluZSwgaW5kZXgpID0+IHsNCiAgICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKGxpbmUpOw0KICAgICAgfSk7DQogICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5hY3RpdmVTaGFwZSkucmVtb3ZlKHRoaXMuYWN0aXZlTGluZSk7DQogICAgICB2YXIgcG9seWdvbiA9IG5ldyBmYWJyaWMuUG9seWdvbihwb2ludHMsIHsNCiAgICAgICAgc3Ryb2tlOiB0aGlzLmNvbG9yLA0KICAgICAgICBzdHJva2VXaWR0aDogdGhpcy5kcmF3V2lkdGgsDQogICAgICAgIGZpbGw6ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDApIiwNCiAgICAgICAgb3BhY2l0eTogMSwNCiAgICAgICAgaGFzQm9yZGVyczogdHJ1ZSwNCiAgICAgICAgaGFzQ29udHJvbHM6IGZhbHNlDQogICAgICB9KTsNCiAgICAgIHRoaXMuY2FudmFzLmFkZChwb2x5Z29uKTsNCiAgICAgIHRoaXMuYWN0aXZlTGluZSA9IG51bGw7DQogICAgICB0aGlzLmFjdGl2ZVNoYXBlID0gbnVsbDsNCiAgICAgIHRoaXMucG9seWdvbk1vZGUgPSBmYWxzZTsNCiAgICAgIHRoaXMuZG9EcmF3aW5nID0gZmFsc2U7DQogICAgICB0aGlzLmRyYXdUeXBlID0gbnVsbDsNCiAgICB9LA0KICAgIGRyYXdpbmcoZSkgew0KICAgICAgaWYgKHRoaXMuZHJhd2luZ09iamVjdCkgew0KICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5kcmF3aW5nT2JqZWN0KTsNCiAgICAgIH0NCiAgICAgIHZhciBjYW52YXNPYmplY3QgPSBudWxsOw0KICAgICAgdmFyIGxlZnQgPSB0aGlzLm1vdXNlRnJvbS54LA0KICAgICAgICAgIHRvcCA9IHRoaXMubW91c2VGcm9tLnksDQogICAgICAgICAgbW91c2VGcm9tID0gdGhpcy5tb3VzZUZyb20sDQogICAgICAgICAgbW91c2VUbyA9IHRoaXMubW91c2VUbzsNCiAgICAgIHN3aXRjaCAodGhpcy5kcmF3VHlwZSkgew0KICAgICAgICBjYXNlICJhcnJvdyI6IC8v566t5aS0DQogICAgICAgICAgdmFyIHgxID0gbW91c2VGcm9tLngsDQogICAgICAgICAgICAgIHgyID0gbW91c2VUby54LA0KICAgICAgICAgICAgICB5MSA9IG1vdXNlRnJvbS55LA0KICAgICAgICAgICAgICB5MiA9IG1vdXNlVG8ueTsNCiAgICAgICAgICB2YXIgdyA9IHgyIC0geDEsDQogICAgICAgICAgICAgIGggPSB5MiAtIHkxLA0KICAgICAgICAgICAgICBzaCA9IE1hdGguY29zKE1hdGguUEkgLyA0KSAqIDE2Ow0KICAgICAgICAgIHZhciBzaW4gPSBoIC8gTWF0aC5zcXJ0KE1hdGgucG93KHcsIDIpICsgTWF0aC5wb3coaCwgMikpOw0KICAgICAgICAgIHZhciBjb3MgPSB3IC8gTWF0aC5zcXJ0KE1hdGgucG93KHcsIDIpICsgTWF0aC5wb3coaCwgMikpOw0KICAgICAgICAgIHZhciB3MSA9ICgxNiAqIHNpbikgLyA0LA0KICAgICAgICAgICAgICBoMSA9ICgxNiAqIGNvcykgLyA0LA0KICAgICAgICAgICAgICBjZW50ZXJ4ID0gc2ggKiBjb3MsDQogICAgICAgICAgICAgIGNlbnRlcnkgPSBzaCAqIHNpbjsNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBjZW50ZXJ4LGNlbnRlcnkg6KGo56S66LW35aeL54K577yM57uI54K56L+e57q/5LiO566t5aS05bCW56uv562J6L655LiJ6KeS5b2i5Lqk54K555u45a+5eO+8jHkNCiAgICAgICAgICAgKiB3MSDvvIxoMeeUqOS6juehruWumuWbm+S4queCuQ0KICAgICAgICAgICAqLw0KICAgICAgICAgIHZhciBwYXRoID0gIiBNICIgKyB4MSArICIgIiArIHkxOw0KICAgICAgICAgIHBhdGggKz0gIiBMICIgKyAoeDIgLSBjZW50ZXJ4ICsgdzEpICsgIiAiICsgKHkyIC0gY2VudGVyeSAtIGgxKTsNCiAgICAgICAgICBwYXRoICs9DQogICAgICAgICAgICAgICIgTCAiICsgKHgyIC0gY2VudGVyeCArIHcxICogMikgKyAiICIgKyAoeTIgLSBjZW50ZXJ5IC0gaDEgKiAyKTsNCiAgICAgICAgICBwYXRoICs9ICIgTCAiICsgeDIgKyAiICIgKyB5MjsNCiAgICAgICAgICBwYXRoICs9DQogICAgICAgICAgICAgICIgTCAiICsgKHgyIC0gY2VudGVyeCAtIHcxICogMikgKyAiICIgKyAoeTIgLSBjZW50ZXJ5ICsgaDEgKiAyKTsNCiAgICAgICAgICBwYXRoICs9ICIgTCAiICsgKHgyIC0gY2VudGVyeCAtIHcxKSArICIgIiArICh5MiAtIGNlbnRlcnkgKyBoMSk7DQogICAgICAgICAgcGF0aCArPSAiIFoiOw0KICAgICAgICAgIGNhbnZhc09iamVjdCA9IG5ldyBmYWJyaWMuUGF0aChwYXRoLCB7DQogICAgICAgICAgICBzdHJva2U6IHRoaXMuY29sb3IsDQogICAgICAgICAgICBmaWxsOiB0aGlzLmNvbG9yLA0KICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IHRoaXMuZHJhd1dpZHRoDQogICAgICAgICAgfSk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgInBlbnRhZ3JhbSI6IC8v5LqU6KeS5pifDQogICAgICAgICAgdmFyIHgxID0gbW91c2VGcm9tLngsDQogICAgICAgICAgICAgIHgyID0gbW91c2VUby54LA0KICAgICAgICAgICAgICB5MSA9IG1vdXNlRnJvbS55LA0KICAgICAgICAgICAgICB5MiA9IG1vdXNlVG8ueTsNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiDlrp7njrDmgJ3ot68gICh4MSx5MSnooajnpLrpvKDmoIfotbflp4vnmoTkvY3nva4gKHgyLHkyKeihqOekuum8oOagh+aKrOi1t+eahOS9jee9rg0KICAgICAgICAgICAqIHIg6KGo56S65LqU6L655b2i5aSW5ZyI5ZyG55qE5Y2K5b6E77yM6L+Z6YeM5bu66K6u6Ieq5bex55S75Liq5Zu+55CG6KejDQogICAgICAgICAgICog5q2j5LqU6L655b2i5aS56KeS5Li6MzbluqbjgILorqHnrpflh7pjb3MxOMKw77yMc2luMTjCsOWkh+eUqA0KICAgICAgICAgICAqLw0KICAgICAgICAgIHZhciB3ID0gTWF0aC5hYnMoeDIgLSB4MSksDQogICAgICAgICAgICAgIGggPSBNYXRoLmFicyh5MiAtIHkxKSwNCiAgICAgICAgICAgICAgciA9IE1hdGguc3FydCh3ICogdyArIGggKiBoKQ0KICAgICAgICAgIHZhciBjb3MxOCA9IE1hdGguY29zKDE4ICogTWF0aC5QSSAvIDE4MCkNCiAgICAgICAgICB2YXIgc2luMTggPSBNYXRoLnNpbigxOCAqIE1hdGguUEkgLyAxODApDQogICAgICAgICAgLyoqDQogICAgICAgICAgICog566X5Ye65a+55bqU5LqU5Liq54K555qE5Z2Q5qCH6L2s5YyW5Li66Lev5b6EDQogICAgICAgICAgICovDQogICAgICAgICAgdmFyIHBvaW50MSA9IFt4MSwgeTEgKyByXQ0KICAgICAgICAgIHZhciBwb2ludDIgPSBbeDEgKyAyICogciAqIChzaW4xOCksIHkxICsgciAtIDIgKiByICogKGNvczE4KV0NCiAgICAgICAgICB2YXIgcG9pbnQzID0gW3gxIC0gciAqIChjb3MxOCksIHkxICsgciAqIChzaW4xOCldDQogICAgICAgICAgdmFyIHBvaW50NCA9IFt4MSArIHIgKiAoY29zMTgpLCB5MSArIHIgKiAoc2luMTgpXQ0KICAgICAgICAgIHZhciBwb2ludDUgPSBbeDEgLSAyICogciAqIChzaW4xOCksIHkxICsgciAtIDIgKiByICogKGNvczE4KV0NCiAgICAgICAgICB2YXIgcGF0aCA9ICIgTSAiICsgcG9pbnQxWzBdICsgIiAiICsgcG9pbnQxWzFdDQogICAgICAgICAgcGF0aCArPSAiIEwgIiArIHBvaW50MlswXSArICIgIiArIHBvaW50MlsxXQ0KICAgICAgICAgIHBhdGggKz0gIiBMICIgKyBwb2ludDNbMF0gKyAiICIgKyBwb2ludDNbMV0NCiAgICAgICAgICBwYXRoICs9ICIgTCAiICsgcG9pbnQ0WzBdICsgIiAiICsgcG9pbnQ0WzFdDQogICAgICAgICAgcGF0aCArPSAiIEwgIiArIHBvaW50NVswXSArICIgIiArIHBvaW50NVsxXQ0KICAgICAgICAgIHBhdGggKz0gIiBaIjsNCiAgICAgICAgICBjYW52YXNPYmplY3QgPSBuZXcgZmFicmljLlBhdGgocGF0aCwgew0KICAgICAgICAgICAgc3Ryb2tlOiB0aGlzLmNvbG9yLA0KICAgICAgICAgICAgZmlsbDogdGhpcy5jb2xvciwNCiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiB0aGlzLmRyYXdXaWR0aCwNCiAgICAgICAgICAgIC8vIGFuZ2xlOjE4MCwgIC8v6K6+572u5peL6L2s6KeS5bqmDQogICAgICAgICAgfSk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgImVsbGlwc2UiOiAvL+akreWchg0KICAgICAgICAgIC8vIOaMiXNoaWZ05pe255S75q2j5ZyG77yM5Y+q5pyJ5Zyo6byg5qCH56e75Yqo5pe25omN5omn6KGM6L+Z5Liq77yM5omA5Lul5oyJ5LqGc2hpZnTkvYbmmK/msqHmnInmi5bliqjpvKDmoIflsIbkuI3kvJrnlLvlnIYNCiAgICAgICAgICBpZiAoZS5lLnNoaWZ0S2V5KSB7DQogICAgICAgICAgICBtb3VzZVRvLnggLSBsZWZ0ID4gbW91c2VUby55IC0gdG9wID8gbW91c2VUby55ID0gdG9wICsgbW91c2VUby54IC0gbGVmdCA6IG1vdXNlVG8ueCA9IGxlZnQgKyBtb3VzZVRvLnkgLSB0b3ANCiAgICAgICAgICB9DQogICAgICAgICAgdmFyIHJhZGl1cyA9DQogICAgICAgICAgICAgIE1hdGguc3FydCgNCiAgICAgICAgICAgICAgICAgIChtb3VzZVRvLnggLSBsZWZ0KSAqIChtb3VzZVRvLnggLSBsZWZ0KSArDQogICAgICAgICAgICAgICAgICAobW91c2VUby55IC0gdG9wKSAqIChtb3VzZVRvLnkgLSB0b3ApDQogICAgICAgICAgICAgICkgLyAyOw0KICAgICAgICAgIGNhbnZhc09iamVjdCA9IG5ldyBmYWJyaWMuRWxsaXBzZSh7DQogICAgICAgICAgICBsZWZ0OiAobW91c2VUby54IC0gbGVmdCkgLyAyICsgbGVmdCwNCiAgICAgICAgICAgIHRvcDogKG1vdXNlVG8ueSAtIHRvcCkgLyAyICsgdG9wLA0KICAgICAgICAgICAgc3Ryb2tlOiB0aGlzLmNvbG9yLA0KICAgICAgICAgICAgZmlsbDogInJnYmEoMjU1LCAyNTUsIDI1NSwgMCkiLA0KICAgICAgICAgICAgb3JpZ2luWDogImNlbnRlciIsDQogICAgICAgICAgICBvcmlnaW5ZOiAiY2VudGVyIiwNCiAgICAgICAgICAgIHJ4OiBNYXRoLmFicyhsZWZ0IC0gbW91c2VUby54KSAvIDIsDQogICAgICAgICAgICByeTogTWF0aC5hYnModG9wIC0gbW91c2VUby55KSAvIDIsDQogICAgICAgICAgICBzdHJva2VXaWR0aDogdGhpcy5kcmF3V2lkdGgNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAicmVjdGFuZ2xlIjogLy/plb/mlrnlvaINCiAgICAgICAgICAvLyDmjIlzaGlmdOaXtueUu+ato+aWueWeiw0KICAgICAgICAgIGlmIChlLmUuc2hpZnRLZXkpIHsNCiAgICAgICAgICAgIG1vdXNlVG8ueCAtIGxlZnQgPiBtb3VzZVRvLnkgLSB0b3AgPyBtb3VzZVRvLnkgPSB0b3AgKyBtb3VzZVRvLnggLSBsZWZ0IDogbW91c2VUby54ID0gbGVmdCArIG1vdXNlVG8ueSAtIHRvcA0KICAgICAgICAgIH0NCiAgICAgICAgICB2YXIgcGF0aCA9DQogICAgICAgICAgICAgICJNICIgKw0KICAgICAgICAgICAgICBtb3VzZUZyb20ueCArDQogICAgICAgICAgICAgICIgIiArDQogICAgICAgICAgICAgIG1vdXNlRnJvbS55ICsNCiAgICAgICAgICAgICAgIiBMICIgKw0KICAgICAgICAgICAgICBtb3VzZVRvLnggKw0KICAgICAgICAgICAgICAiICIgKw0KICAgICAgICAgICAgICBtb3VzZUZyb20ueSArDQogICAgICAgICAgICAgICIgTCAiICsNCiAgICAgICAgICAgICAgbW91c2VUby54ICsNCiAgICAgICAgICAgICAgIiAiICsNCiAgICAgICAgICAgICAgbW91c2VUby55ICsNCiAgICAgICAgICAgICAgIiBMICIgKw0KICAgICAgICAgICAgICBtb3VzZUZyb20ueCArDQogICAgICAgICAgICAgICIgIiArDQogICAgICAgICAgICAgIG1vdXNlVG8ueSArDQogICAgICAgICAgICAgICIgTCAiICsNCiAgICAgICAgICAgICAgbW91c2VGcm9tLnggKw0KICAgICAgICAgICAgICAiICIgKw0KICAgICAgICAgICAgICBtb3VzZUZyb20ueSArDQogICAgICAgICAgICAgICIgeiI7DQogICAgICAgICAgY2FudmFzT2JqZWN0ID0gbmV3IGZhYnJpYy5QYXRoKHBhdGgsIHsNCiAgICAgICAgICAgIGxlZnQ6IGxlZnQsDQogICAgICAgICAgICB0b3A6IHRvcCwNCiAgICAgICAgICAgIHN0cm9rZTogdGhpcy5jb2xvciwNCiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiB0aGlzLmRyYXdXaWR0aCwNCiAgICAgICAgICAgIGZpbGw6ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDApIiwNCiAgICAgICAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIC8v5Lmf5Y+v5Lul5L2/55SoZmFicmljLlJlY3QNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAidGV4dCI6IC8v5paH5pys5qGGDQogICAgICAgICAgdGhpcy50ZXh0Ym94ID0gbmV3IGZhYnJpYy5UZXh0Ym94KCIiLCB7DQogICAgICAgICAgICBsZWZ0OiBtb3VzZUZyb20ueCwNCiAgICAgICAgICAgIHRvcDogbW91c2VGcm9tLnkgLSAxMCwNCiAgICAgICAgICAgIC8vIHdpZHRoOiAxNTAsDQogICAgICAgICAgICBmb250U2l6ZTogMTYsDQogICAgICAgICAgICBib3JkZXJDb2xvcjogdGhpcy5jb2xvciwNCiAgICAgICAgICAgIGZpbGw6IHRoaXMuY29sb3IsDQogICAgICAgICAgICBoYXNDb250cm9sczogZmFsc2UNCiAgICAgICAgICB9KTsNCiAgICAgICAgICB0aGlzLmNhbnZhcy5hZGQodGhpcy50ZXh0Ym94KTsNCiAgICAgICAgICB0aGlzLnRleHRib3guZW50ZXJFZGl0aW5nKCk7DQogICAgICAgICAgdGhpcy50ZXh0Ym94LmhpZGRlblRleHRhcmVhLmZvY3VzKCk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICBpZiAoY2FudmFzT2JqZWN0KSB7DQogICAgICAgIC8vIGNhbnZhc09iamVjdC5pbmRleCA9IGdldENhbnZhc09iamVjdEluZGV4KCk7XA0KICAgICAgICB0aGlzLmNhbnZhcy5hZGQoY2FudmFzT2JqZWN0KTsgLy8uc2V0QWN0aXZlT2JqZWN0KGNhbnZhc09iamVjdCkNCiAgICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0ID0gY2FudmFzT2JqZWN0Ow0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmNhbnZhcyA9IG5ldyBmYWJyaWMuQ2FudmFzKCJjYW52YXMiLCB7DQogICAgICAvLyBza2lwVGFyZ2V0RmluZDogZmFsc2UsIC8v5b2T5Li655yf5pe277yM6Lez6L+H55uu5qCH5qOA5rWL44CC55uu5qCH5qOA5rWL5bCG6L+U5Zue5aeL57uI5pyq5a6a5LmJ44CC54K55Ye76YCJ5oup5bCG5peg5pWIDQogICAgICAvLyBzZWxlY3RhYmxlOiBmYWxzZSwgIC8v5Li6ZmFsc2Xml7bvvIzkuI3og73pgInmi6nlr7nosaHov5vooYzkv67mlLkNCiAgICAgIC8vIHNlbGVjdGlvbjogZmFsc2UgICAvLyDmmK/lkKblj6/ku6XlpJrkuKrlr7nosaHkuLrkuIDnu4QNCiAgICB9KTsNCiAgICB0aGlzLmNhbnZhcy5zZWxlY3Rpb25Db2xvciA9ICJyZ2JhKDAsMCwwLDAuMDUpIjsNCiAgICB0aGlzLmNhbnZhcy5vbigibW91c2U6ZG93biIsIHRoaXMubW91c2Vkb3duKTsNCiAgICB0aGlzLmNhbnZhcy5vbigibW91c2U6bW92ZSIsIHRoaXMubW91c2Vtb3ZlKTsNCiAgICB0aGlzLmNhbnZhcy5vbigibW91c2U6dXAiLCB0aGlzLm1vdXNldXApOw0KICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9IGUgPT4gew0KICAgICAgLy8g6ZSu55uYIGRlbGVjdOWIoOmZpOaJgOmAieWFg+e0oA0KICAgICAgaWYgKGUua2V5Q29kZSA9PSA0Nikgew0KICAgICAgICB0aGlzLmRlbGV0ZU9iaigpOw0KICAgICAgfQ0KICAgICAgLy8gY3RybCt6IOWIoOmZpOacgOi/kea3u+WKoOeahOWFg+e0oA0KICAgICAgaWYgKGUua2V5Q29kZSA9PSA5MCAmJiBlLmN0cmxLZXkpIHsNCiAgICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKA0KICAgICAgICAgICAgdGhpcy5jYW52YXMuZ2V0T2JqZWN0cygpW3RoaXMuY2FudmFzLmdldE9iamVjdHMoKS5sZW5ndGggLSAxXQ0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH07DQogICAgLy8gdmFyIG9yaWdpbmFsUmVuZGVyID0gZmFicmljLlRleHRib3gucHJvdG90eXBlLl9yZW5kZXI7DQogICAgLy8gZmFicmljLlRleHRib3gucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbihjdHgpIHsNCiAgICAvLyAgIG9yaWdpbmFsUmVuZGVyLmNhbGwodGhpcywgY3R4KTsNCiAgICAvLyAgIC8vRG9uJ3QgZHJhdyBib3JkZXIgaWYgaXQgaXMgYWN0aXZlKHNlbGVjdGVkLyBlZGl0aW5nIG1vZGUpDQogICAgLy8gICBpZiAodGhpcy5hY3RpdmUpIHJldHVybjsNCiAgICAvLyAgIGlmKHRoaXMuc2hvd1RleHRCb3hCb3JkZXIpew0KICAgIC8vICAgICB2YXIgdyA9IHRoaXMud2lkdGgsDQogICAgLy8gICAgICAgaCA9IHRoaXMuaGVpZ2h0LA0KICAgIC8vICAgICAgIHggPSAtdGhpcy53aWR0aCAvIDIsDQogICAgLy8gICAgICAgeSA9IC10aGlzLmhlaWdodCAvIDI7DQogICAgLy8gICAgIGN0eC5iZWdpblBhdGgoKTsNCiAgICAvLyAgICAgY3R4Lm1vdmVUbyh4LCB5KTsNCiAgICAvLyAgICAgY3R4LmxpbmVUbyh4ICsgdywgeSk7DQogICAgLy8gICAgIGN0eC5saW5lVG8oeCArIHcsIHkgKyBoKTsNCiAgICAvLyAgICAgY3R4LmxpbmVUbyh4LCB5ICsgaCk7DQogICAgLy8gICAgIGN0eC5saW5lVG8oeCwgeSk7DQogICAgLy8gICAgIGN0eC5jbG9zZVBhdGgoKTsNCiAgICAvLyAgICAgdmFyIHN0cm9rZSA9IGN0eC5zdHJva2VTdHlsZTsNCiAgICAvLyAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy50ZXh0Ym94Qm9yZGVyQ29sb3I7DQogICAgLy8gICAgIGN0eC5zdHJva2UoKTsNCiAgICAvLyAgICAgY3R4LnN0cm9rZVN0eWxlID0gc3Ryb2tlOw0KICAgIC8vICAgfQ0KICAgIC8vIH0NCiAgICAvLyBmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUuY2FjaGVQcm9wZXJ0aWVzID0gZmFicmljLlRleHRib3gucHJvdG90eXBlLmNhY2hlUHJvcGVydGllcy5jb25jYXQoJ2FjdGl2ZScpOw0KICB9DQp9Ow0K"},{"version":3,"sources":["Draw.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Draw.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"maintenancePlanAdd\">\r\n    <div class=\"child-panel-title\">\r\n      <h2>图形标注</h2>\r\n    </div>\r\n    <div class=\"panel-body\">\r\n      <div class=\"demo\">\r\n        <canvas id=\"canvas\" :width=\"width\" :height=\"height\"></canvas>\r\n        <div class=\"draw-btn-group\">\r\n          <div :class=\"{active:drawType==''}\" title=\"自由选择\" @click=\"drawTypeChange('')\">\r\n            <i class=\"draw-icon icon-mouse\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='arrow'}\" title=\"画箭头\" @click=\"drawTypeChange('arrow')\">\r\n            <i class=\"draw-icon icon-1\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='text'}\" title=\"文本输入框\" @click=\"drawTypeChange('text')\">\r\n            <i class=\"draw-icon icon-2\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='ellipse'}\" title=\"画圆\" @click=\"drawTypeChange('ellipse')\">\r\n            <i class=\"draw-icon icon-3\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='rectangle'}\" title=\"画矩形\" @click=\"drawTypeChange('rectangle')\">\r\n            <i class=\"draw-icon icon-4\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='polygon'}\" title=\"画多边形\" @click=\"drawPolygon\">\r\n            <i class=\"draw-icon icon-6\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='pen'}\" title=\"笔画\" @click=\"drawTypeChange('pen')\">\r\n            <i class=\"draw-icon icon-7\"></i>\r\n          </div>\r\n          <div :class=\"{active:drawType=='pentagram'}\" title=\"五角星\" @click=\"drawTypeChange('pentagram')\">\r\n            <i class=\"draw-icon icon-pentagram\"></i>\r\n          </div>\r\n          <div @click=\"uploadImg\" title=\"从文件选择图片上传\">\r\n            <i class=\"draw-icon icon-img\"></i>\r\n          </div>\r\n          <div @click=\"loadExpImg\" title=\"加载背景图\">\r\n            <i class=\"draw-icon icon-back\"></i>\r\n          </div>\r\n          <div @click=\"save\" title=\"保存\">\r\n            <i class=\"draw-icon icon-save\"></i>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <input type=\"file\" @change=\"uploadImgChange\" id=\"imgInput\" accept=\"image/*\" />\r\n    <img id=\"img\" :src=\"imgSrc\" />\r\n    <img id=\"expImg\" src=\"../assets/icons/draw/exp.jpg\" />\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n  name: \"Draw\",\r\n  data() {\r\n    return {\r\n      width: 1280,\r\n      height: 620,\r\n      rect: [],\r\n      canvas: {},\r\n      showMenu: false,\r\n      x: \"\",\r\n      y: \"\",\r\n      mouseFrom: {},\r\n      mouseTo: {},\r\n      drawType: null,  //当前绘制图像的种类\r\n      canvasObjectIndex: 0,\r\n      textbox: null,\r\n      rectangleLabel: \"warning\",\r\n      drawWidth: 2, //笔触宽度\r\n      color: \"#E34F51\", //画笔颜色\r\n      drawingObject: null, //当前绘制对象\r\n      moveCount: 1, //绘制移动计数器\r\n      doDrawing: false, // 绘制状态\r\n      //polygon 相关参数\r\n      polygonMode: false,\r\n      pointArray: [],\r\n      lineArray: [],\r\n      activeShape: false,\r\n      activeLine: \"\",\r\n      line: {},\r\n      delectKlass: {},\r\n      imgFile: {},\r\n      imgSrc: \"\",\r\n    };\r\n  },\r\n  watch: {\r\n    drawType() {\r\n      this.canvas.selection = !this.drawType;\r\n    },\r\n    width() {\r\n      this.canvas.setWidth(this.width)\r\n    },\r\n    height() {\r\n      this.canvas.setHeight(this.height)\r\n    },\r\n  },\r\n  methods: {\r\n    // 保存当前画布为png图片\r\n    save() {\r\n      var canvas = document.getElementById('canvas')\r\n      var imgData = canvas.toDataURL('png');\r\n      imgData = imgData.replace('image/png', 'image/octet-stream');\r\n      // 下载后的问题名，可自由指定\r\n      var filename = 'drawingboard_' + (new Date()).getTime() + '.' + 'png';\r\n      this.saveFile(imgData, filename);\r\n    },\r\n    saveFile(data, filename) {\r\n      var save_link = document.createElement('a');\r\n      save_link.href = data;\r\n      save_link.download = filename;\r\n      var event = document.createEvent('MouseEvents');\r\n      event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\r\n      save_link.dispatchEvent(event);\r\n    },\r\n    uploadImg() {\r\n      document.getElementById(\"imgInput\").click();\r\n    },\r\n    // 从已渲染的DOM元素加载图片至canvas\r\n    loadExpImg() {\r\n      var imgElement = document.getElementById(\"expImg\"); //声明我们的图片\r\n      var imgInstance = new fabric.Image(imgElement, {\r\n        selectable: false\r\n        // zIndex:-99,\r\n      });\r\n      this.canvas.add(imgInstance);\r\n    },\r\n    // 从文件加载图片至canvas\r\n    uploadImgChange() {\r\n      // 获取文件\r\n      var eleImportInput = document.getElementById(\"imgInput\");\r\n      this.imgFile = eleImportInput.files[0];\r\n      var imgSrc = \"\",\r\n          imgTitle = \"\";\r\n      // 从reader中获取选择文件的src\r\n      if (/\\.(jpe?g|png|gif)$/i.test(this.imgFile.name)) {\r\n        var reader = new FileReader();\r\n        var _this = this;\r\n        reader.addEventListener(\r\n            \"load\",\r\n            function () {\r\n              imgTitle = _this.imgFile.name;\r\n              _this.imgSrc = this.result;\r\n            },\r\n            false\r\n        );\r\n        reader.readAsDataURL(this.imgFile);\r\n      }\r\n      var imgElement = document.getElementById(\"img\"); //声明我们的图片\r\n      imgElement.onload = () => {\r\n        this.width = imgElement.width\r\n        this.height = imgElement.height\r\n        var imgInstance = new fabric.Image(imgElement, {\r\n          zIndex: -1,\r\n          selectable: false\r\n        });\r\n        this.canvas.add(imgInstance);\r\n      };\r\n    },\r\n    // 开始绘制时，指定绘画种类\r\n    drawTypeChange(e) {\r\n      this.drawType = e;\r\n      this.canvas.skipTargetFind = !!e\r\n      if (e == \"pen\") {\r\n        // isDrawingMode为true 才可以自由绘画\r\n        this.canvas.isDrawingMode = true;\r\n      } else {\r\n        this.canvas.isDrawingMode = false;\r\n      }\r\n    },\r\n    // 鼠标按下时触发\r\n    mousedown(e) {\r\n      // 记录鼠标按下时的坐标\r\n      var xy = e.pointer || this.transformMouse(e.e.offsetX, e.e.offsetY);\r\n      this.mouseFrom.x = xy.x;\r\n      this.mouseFrom.y = xy.y;\r\n      this.doDrawing = true;\r\n      if (this.drawType == \"text\") {\r\n        this.drawing();\r\n      }\r\n      if (this.textbox) {\r\n        this.textbox.enterEditing();\r\n        this.textbox.hiddenTextarea.focus();\r\n      }\r\n      // 绘制多边形\r\n      if (this.drawType == \"polygon\") {\r\n        this.canvas.skipTargetFind = false;\r\n        try {\r\n          // 此段为判断是否闭合多边形，点击红点时闭合多边形\r\n          if (this.pointArray.length > 1) {\r\n            // e.target.id == this.pointArray[0].id 表示点击了初始红点\r\n            if (e.target && e.target.id == this.pointArray[0].id) {\r\n              this.generatePolygon();\r\n            }\r\n          }\r\n          //未点击红点则继续作画\r\n          if (this.polygonMode) {\r\n            this.addPoint(e);\r\n          }\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      }\r\n    },\r\n    // 鼠标松开执行\r\n    mouseup(e) {\r\n      var xy = e.pointer || this.transformMouse(e.e.offsetX, e.e.offsetY);\r\n      this.mouseTo.x = xy.x;\r\n      this.mouseTo.y = xy.y;\r\n      this.drawingObject = null;\r\n      this.moveCount = 1;\r\n      if (this.drawType != \"polygon\") {\r\n        this.doDrawing = false;\r\n      }\r\n    },\r\n    //鼠标移动过程中已经完成了绘制\r\n    mousemove(e) {\r\n      if (this.moveCount % 2 && !this.doDrawing) {\r\n        //减少绘制频率\r\n        return;\r\n      }\r\n      this.moveCount++;\r\n      var xy = e.pointer || this.transformMouse(e.e.offsetX, e.e.offsetY);\r\n      this.mouseTo.x = xy.x;\r\n      this.mouseTo.y = xy.y;\r\n      // 多边形与文字框特殊处理\r\n      if (this.drawType != \"text\" || this.drawType != \"polygon\") {\r\n        this.drawing(e);\r\n      }\r\n      if (this.drawType == \"polygon\") {\r\n        if (this.activeLine && this.activeLine.class == \"line\") {\r\n          var pointer = this.canvas.getPointer(e.e);\r\n          this.activeLine.set({ x2: pointer.x, y2: pointer.y });\r\n          var points = this.activeShape.get(\"points\");\r\n          points[this.pointArray.length] = {\r\n            x: pointer.x,\r\n            y: pointer.y,\r\n            zIndex: 1\r\n          };\r\n          this.activeShape.set({\r\n            points: points\r\n          });\r\n          this.canvas.renderAll();\r\n        }\r\n        this.canvas.renderAll();\r\n      }\r\n    },\r\n    deleteObj() {\r\n      this.canvas.getActiveObjects().map(item => {\r\n        this.canvas.remove(item);\r\n      });\r\n    },\r\n    transformMouse(mouseX, mouseY) {\r\n      return { x: mouseX / 1, y: mouseY / 1 };\r\n    },\r\n    // 绘制多边形开始，绘制多边形和其他图形不一样，需要单独处理\r\n    drawPolygon() {\r\n      this.drawType = \"polygon\";\r\n      this.polygonMode = true;\r\n      //这里画的多边形，由顶点与线组成\r\n      this.pointArray = new Array();  // 顶点集合\r\n      this.lineArray = new Array();  //线集合\r\n      this.canvas.isDrawingMode = false;\r\n    },\r\n    addPoint(e) {\r\n      var random = Math.floor(Math.random() * 10000);\r\n      var id = new Date().getTime() + random;\r\n      var circle = new fabric.Circle({\r\n        radius: 5,\r\n        fill: \"#ffffff\",\r\n        stroke: \"#333333\",\r\n        strokeWidth: 0.5,\r\n        left: (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\r\n        top: (e.pointer.y || e.e.layerY) / this.canvas.getZoom(),\r\n        selectable: false,\r\n        hasBorders: false,\r\n        hasControls: false,\r\n        originX: \"center\",\r\n        originY: \"center\",\r\n        id: id,\r\n        objectCaching: false\r\n      });\r\n      if (this.pointArray.length == 0) {\r\n        circle.set({\r\n          fill: \"red\"\r\n        });\r\n      }\r\n      var points = [\r\n        (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\r\n        (e.pointer.y || e.e.layerY) / this.canvas.getZoom(),\r\n        (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\r\n        (e.pointer.y || e.e.layerY) / this.canvas.getZoom()\r\n      ];\r\n      this.line = new fabric.Line(points, {\r\n        strokeWidth: 2,\r\n        fill: \"#999999\",\r\n        stroke: \"#999999\",\r\n        class: \"line\",\r\n        originX: \"center\",\r\n        originY: \"center\",\r\n        selectable: false,\r\n        hasBorders: false,\r\n        hasControls: false,\r\n        evented: false,\r\n        objectCaching: false\r\n      });\r\n      if (this.activeShape) {\r\n        var pos = this.canvas.getPointer(e.e);\r\n        var points = this.activeShape.get(\"points\");\r\n        points.push({\r\n          x: pos.x,\r\n          y: pos.y\r\n        });\r\n        var polygon = new fabric.Polygon(points, {\r\n          stroke: \"#333333\",\r\n          strokeWidth: 1,\r\n          fill: \"#cccccc\",\r\n          opacity: 0.3,\r\n          selectable: false,\r\n          hasBorders: false,\r\n          hasControls: false,\r\n          evented: false,\r\n          objectCaching: false\r\n        });\r\n        this.canvas.remove(this.activeShape);\r\n        this.canvas.add(polygon);\r\n        this.activeShape = polygon;\r\n        this.canvas.renderAll();\r\n      } else {\r\n        var polyPoint = [\r\n          {\r\n            x: (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\r\n            y: (e.pointer.y || e.e.layerY) / this.canvas.getZoom()\r\n          }\r\n        ];\r\n        var polygon = new fabric.Polygon(polyPoint, {\r\n          stroke: \"#333333\",\r\n          strokeWidth: 1,\r\n          fill: \"#cccccc\",\r\n          opacity: 0.3,\r\n          selectable: false,\r\n          hasBorders: false,\r\n          hasControls: false,\r\n          evented: false,\r\n          objectCaching: false\r\n        });\r\n        this.activeShape = polygon;\r\n        this.canvas.add(polygon);\r\n      }\r\n      this.activeLine = this.line;\r\n      this.pointArray.push(circle);\r\n      this.lineArray.push(this.line);\r\n      this.canvas.add(this.line);\r\n      this.canvas.add(circle);\r\n    },\r\n    generatePolygon() {\r\n      var points = new Array();\r\n      this.pointArray.map((point, index) => {\r\n        points.push({\r\n          x: point.left,\r\n          y: point.top\r\n        });\r\n        this.canvas.remove(point);\r\n      });\r\n      this.lineArray.map((line, index) => {\r\n        this.canvas.remove(line);\r\n      });\r\n      this.canvas.remove(this.activeShape).remove(this.activeLine);\r\n      var polygon = new fabric.Polygon(points, {\r\n        stroke: this.color,\r\n        strokeWidth: this.drawWidth,\r\n        fill: \"rgba(255, 255, 255, 0)\",\r\n        opacity: 1,\r\n        hasBorders: true,\r\n        hasControls: false\r\n      });\r\n      this.canvas.add(polygon);\r\n      this.activeLine = null;\r\n      this.activeShape = null;\r\n      this.polygonMode = false;\r\n      this.doDrawing = false;\r\n      this.drawType = null;\r\n    },\r\n    drawing(e) {\r\n      if (this.drawingObject) {\r\n        this.canvas.remove(this.drawingObject);\r\n      }\r\n      var canvasObject = null;\r\n      var left = this.mouseFrom.x,\r\n          top = this.mouseFrom.y,\r\n          mouseFrom = this.mouseFrom,\r\n          mouseTo = this.mouseTo;\r\n      switch (this.drawType) {\r\n        case \"arrow\": //箭头\r\n          var x1 = mouseFrom.x,\r\n              x2 = mouseTo.x,\r\n              y1 = mouseFrom.y,\r\n              y2 = mouseTo.y;\r\n          var w = x2 - x1,\r\n              h = y2 - y1,\r\n              sh = Math.cos(Math.PI / 4) * 16;\r\n          var sin = h / Math.sqrt(Math.pow(w, 2) + Math.pow(h, 2));\r\n          var cos = w / Math.sqrt(Math.pow(w, 2) + Math.pow(h, 2));\r\n          var w1 = (16 * sin) / 4,\r\n              h1 = (16 * cos) / 4,\r\n              centerx = sh * cos,\r\n              centery = sh * sin;\r\n          /**\r\n           * centerx,centery 表示起始点，终点连线与箭头尖端等边三角形交点相对x，y\r\n           * w1 ，h1用于确定四个点\r\n           */\r\n          var path = \" M \" + x1 + \" \" + y1;\r\n          path += \" L \" + (x2 - centerx + w1) + \" \" + (y2 - centery - h1);\r\n          path +=\r\n              \" L \" + (x2 - centerx + w1 * 2) + \" \" + (y2 - centery - h1 * 2);\r\n          path += \" L \" + x2 + \" \" + y2;\r\n          path +=\r\n              \" L \" + (x2 - centerx - w1 * 2) + \" \" + (y2 - centery + h1 * 2);\r\n          path += \" L \" + (x2 - centerx - w1) + \" \" + (y2 - centery + h1);\r\n          path += \" Z\";\r\n          canvasObject = new fabric.Path(path, {\r\n            stroke: this.color,\r\n            fill: this.color,\r\n            strokeWidth: this.drawWidth\r\n          });\r\n          break;\r\n        case \"pentagram\": //五角星\r\n          var x1 = mouseFrom.x,\r\n              x2 = mouseTo.x,\r\n              y1 = mouseFrom.y,\r\n              y2 = mouseTo.y;\r\n          /**\r\n           * 实现思路  (x1,y1)表示鼠标起始的位置 (x2,y2)表示鼠标抬起的位置\r\n           * r 表示五边形外圈圆的半径，这里建议自己画个图理解\r\n           * 正五边形夹角为36度。计算出cos18°，sin18°备用\r\n           */\r\n          var w = Math.abs(x2 - x1),\r\n              h = Math.abs(y2 - y1),\r\n              r = Math.sqrt(w * w + h * h)\r\n          var cos18 = Math.cos(18 * Math.PI / 180)\r\n          var sin18 = Math.sin(18 * Math.PI / 180)\r\n          /**\r\n           * 算出对应五个点的坐标转化为路径\r\n           */\r\n          var point1 = [x1, y1 + r]\r\n          var point2 = [x1 + 2 * r * (sin18), y1 + r - 2 * r * (cos18)]\r\n          var point3 = [x1 - r * (cos18), y1 + r * (sin18)]\r\n          var point4 = [x1 + r * (cos18), y1 + r * (sin18)]\r\n          var point5 = [x1 - 2 * r * (sin18), y1 + r - 2 * r * (cos18)]\r\n          var path = \" M \" + point1[0] + \" \" + point1[1]\r\n          path += \" L \" + point2[0] + \" \" + point2[1]\r\n          path += \" L \" + point3[0] + \" \" + point3[1]\r\n          path += \" L \" + point4[0] + \" \" + point4[1]\r\n          path += \" L \" + point5[0] + \" \" + point5[1]\r\n          path += \" Z\";\r\n          canvasObject = new fabric.Path(path, {\r\n            stroke: this.color,\r\n            fill: this.color,\r\n            strokeWidth: this.drawWidth,\r\n            // angle:180,  //设置旋转角度\r\n          });\r\n          break;\r\n        case \"ellipse\": //椭圆\r\n          // 按shift时画正圆，只有在鼠标移动时才执行这个，所以按了shift但是没有拖动鼠标将不会画圆\r\n          if (e.e.shiftKey) {\r\n            mouseTo.x - left > mouseTo.y - top ? mouseTo.y = top + mouseTo.x - left : mouseTo.x = left + mouseTo.y - top\r\n          }\r\n          var radius =\r\n              Math.sqrt(\r\n                  (mouseTo.x - left) * (mouseTo.x - left) +\r\n                  (mouseTo.y - top) * (mouseTo.y - top)\r\n              ) / 2;\r\n          canvasObject = new fabric.Ellipse({\r\n            left: (mouseTo.x - left) / 2 + left,\r\n            top: (mouseTo.y - top) / 2 + top,\r\n            stroke: this.color,\r\n            fill: \"rgba(255, 255, 255, 0)\",\r\n            originX: \"center\",\r\n            originY: \"center\",\r\n            rx: Math.abs(left - mouseTo.x) / 2,\r\n            ry: Math.abs(top - mouseTo.y) / 2,\r\n            strokeWidth: this.drawWidth\r\n          });\r\n          break;\r\n        case \"rectangle\": //长方形\r\n          // 按shift时画正方型\r\n          if (e.e.shiftKey) {\r\n            mouseTo.x - left > mouseTo.y - top ? mouseTo.y = top + mouseTo.x - left : mouseTo.x = left + mouseTo.y - top\r\n          }\r\n          var path =\r\n              \"M \" +\r\n              mouseFrom.x +\r\n              \" \" +\r\n              mouseFrom.y +\r\n              \" L \" +\r\n              mouseTo.x +\r\n              \" \" +\r\n              mouseFrom.y +\r\n              \" L \" +\r\n              mouseTo.x +\r\n              \" \" +\r\n              mouseTo.y +\r\n              \" L \" +\r\n              mouseFrom.x +\r\n              \" \" +\r\n              mouseTo.y +\r\n              \" L \" +\r\n              mouseFrom.x +\r\n              \" \" +\r\n              mouseFrom.y +\r\n              \" z\";\r\n          canvasObject = new fabric.Path(path, {\r\n            left: left,\r\n            top: top,\r\n            stroke: this.color,\r\n            strokeWidth: this.drawWidth,\r\n            fill: \"rgba(255, 255, 255, 0)\",\r\n            hasControls: false\r\n          });\r\n          //也可以使用fabric.Rect\r\n          break;\r\n        case \"text\": //文本框\r\n          this.textbox = new fabric.Textbox(\"\", {\r\n            left: mouseFrom.x,\r\n            top: mouseFrom.y - 10,\r\n            // width: 150,\r\n            fontSize: 16,\r\n            borderColor: this.color,\r\n            fill: this.color,\r\n            hasControls: false\r\n          });\r\n          this.canvas.add(this.textbox);\r\n          this.textbox.enterEditing();\r\n          this.textbox.hiddenTextarea.focus();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n      if (canvasObject) {\r\n        // canvasObject.index = getCanvasObjectIndex();\\\r\n        this.canvas.add(canvasObject); //.setActiveObject(canvasObject)\r\n        this.drawingObject = canvasObject;\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.canvas = new fabric.Canvas(\"canvas\", {\r\n      // skipTargetFind: false, //当为真时，跳过目标检测。目标检测将返回始终未定义。点击选择将无效\r\n      // selectable: false,  //为false时，不能选择对象进行修改\r\n      // selection: false   // 是否可以多个对象为一组\r\n    });\r\n    this.canvas.selectionColor = \"rgba(0,0,0,0.05)\";\r\n    this.canvas.on(\"mouse:down\", this.mousedown);\r\n    this.canvas.on(\"mouse:move\", this.mousemove);\r\n    this.canvas.on(\"mouse:up\", this.mouseup);\r\n    document.onkeydown = e => {\r\n      // 键盘 delect删除所选元素\r\n      if (e.keyCode == 46) {\r\n        this.deleteObj();\r\n      }\r\n      // ctrl+z 删除最近添加的元素\r\n      if (e.keyCode == 90 && e.ctrlKey) {\r\n        this.canvas.remove(\r\n            this.canvas.getObjects()[this.canvas.getObjects().length - 1]\r\n        );\r\n      }\r\n    };\r\n    // var originalRender = fabric.Textbox.prototype._render;\r\n    // fabric.Textbox.prototype._render = function(ctx) {\r\n    //   originalRender.call(this, ctx);\r\n    //   //Don't draw border if it is active(selected/ editing mode)\r\n    //   if (this.active) return;\r\n    //   if(this.showTextBoxBorder){\r\n    //     var w = this.width,\r\n    //       h = this.height,\r\n    //       x = -this.width / 2,\r\n    //       y = -this.height / 2;\r\n    //     ctx.beginPath();\r\n    //     ctx.moveTo(x, y);\r\n    //     ctx.lineTo(x + w, y);\r\n    //     ctx.lineTo(x + w, y + h);\r\n    //     ctx.lineTo(x, y + h);\r\n    //     ctx.lineTo(x, y);\r\n    //     ctx.closePath();\r\n    //     var stroke = ctx.strokeStyle;\r\n    //     ctx.strokeStyle = this.textboxBorderColor;\r\n    //     ctx.stroke();\r\n    //     ctx.strokeStyle = stroke;\r\n    //   }\r\n    // }\r\n    // fabric.Textbox.prototype.cacheProperties = fabric.Textbox.prototype.cacheProperties.concat('active');\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.el-container {\r\n  flex-direction: column;\r\n}\r\nimg,\r\ninput {\r\n  display: none;\r\n}\r\n.demo {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\ncanvas {\r\n  border: 1px dashed black;\r\n}\r\n.draw-btn-group {\r\n  // width: 1270px;\r\n  margin-top: 10px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  & > div {\r\n    background: #fafafa;\r\n    cursor: pointer;\r\n    &:hover {\r\n      background: #eee;\r\n    }\r\n    i {\r\n      display: flex;\r\n      background-repeat: no-repeat;\r\n      background-size: 80%;\r\n      background-position: 50% 50%;\r\n      height: 30px;\r\n      width: 30px;\r\n    }\r\n    .icon-1 {\r\n      background-image: url(\"../assets/icons/draw/1.png\");\r\n    }\r\n    .icon-pentagram {\r\n      background-image: url(\"../assets/icons/draw/pentagram.png\");\r\n    }\r\n    .icon-2 {\r\n      background-image: url(\"../assets/icons/draw/2.png\");\r\n    }\r\n    .icon-3 {\r\n      background-image: url(\"../assets/icons/draw/3.png\");\r\n    }\r\n    .icon-4 {\r\n      background-image: url(\"../assets/icons/draw/4.png\");\r\n      background-size: 75%;\r\n    }\r\n    .icon-5 {\r\n      background-image: url(\"../assets/icons/draw/5.png\");\r\n      background-size: 70%;\r\n    }\r\n    .icon-6 {\r\n      background-image: url(\"../assets/icons/draw/6.png\");\r\n    }\r\n    .icon-7 {\r\n      background-image: url(\"../assets/icons/draw/7.png\");\r\n      background-size: 80%;\r\n    }\r\n    .icon-del {\r\n      background-image: url(\"../assets/icons/draw/del.png\");\r\n      background-size: 90%;\r\n    }\r\n    .icon-img {\r\n      background-image: url(\"../assets/icons/draw/img.png\");\r\n      background-size: 80%;\r\n    }\r\n    .icon-back {\r\n      background-image: url(\"../assets/icons/draw/back.png\");\r\n      background-size: 75%;\r\n    }\r\n    .icon-save {\r\n      background-image: url(\"../assets/icons/draw/save.png\");\r\n      background-size: 80%;\r\n    }\r\n    .icon-mouse {\r\n      background-image: url(\"../assets/icons/draw/mouse.png\");\r\n      background-size: 60%;\r\n    }\r\n  }\r\n  .active {\r\n    background: #eee;\r\n  }\r\n}\r\n</style>"]}]}