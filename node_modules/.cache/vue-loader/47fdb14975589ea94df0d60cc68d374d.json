{"remainingRequest":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\_codes\\MyProjects\\vuetestbs\\src\\App.vue?vue&type=style&index=0&id=7ba5bd90&lang=scss&scoped=true&","dependencies":[{"path":"D:\\_codes\\MyProjects\\vuetestbs\\src\\App.vue","mtime":1611984403645},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\_codes\\MyProjects\\vuetestbs\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5lbC1jb250YWluZXIgewogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KaW1nLAppbnB1dCB7CiAgZGlzcGxheTogbm9uZTsKfQouZGVtbyB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KY2FudmFzIHsKICBib3JkZXI6IDFweCBkYXNoZWQgYmxhY2s7Cn0KLmRyYXctYnRuLWdyb3VwIHsKICAvLyB3aWR0aDogMTI3MHB4OwogIG1hcmdpbi10b3A6IDEwcHg7CiAgZGlzcGxheTogZmxleDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICAmID4gZGl2IHsKICAgIGJhY2tncm91bmQ6ICNmYWZhZmE7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAmOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogI2VlZTsKICAgIH0KICAgIGkgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDgwJTsKICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogNTAlIDUwJTsKICAgICAgaGVpZ2h0OiAzMHB4OwogICAgICB3aWR0aDogMzBweDsKICAgIH0KICAgIC5pY29uLTEgewogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIi4vYXNzZXRzL2ljb25zL2RyYXcvMS5wbmciKTsKICAgIH0KICAgIC5pY29uLXBlbnRhZ3JhbSB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi9hc3NldHMvaWNvbnMvZHJhdy9wZW50YWdyYW0ucG5nIik7CiAgICB9CiAgICAuaWNvbi0yIHsKICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCIuL2Fzc2V0cy9pY29ucy9kcmF3LzIucG5nIik7CiAgICB9CiAgICAuaWNvbi0zIHsKICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCIuL2Fzc2V0cy9pY29ucy9kcmF3LzMucG5nIik7CiAgICB9CiAgICAuaWNvbi00IHsKICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCIuL2Fzc2V0cy9pY29ucy9kcmF3LzQucG5nIik7CiAgICAgIGJhY2tncm91bmQtc2l6ZTogNzUlOwogICAgfQogICAgLmljb24tNSB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi9hc3NldHMvaWNvbnMvZHJhdy81LnBuZyIpOwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDcwJTsKICAgIH0KICAgIC5pY29uLTYgewogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIi4vYXNzZXRzL2ljb25zL2RyYXcvNi5wbmciKTsKICAgIH0KICAgIC5pY29uLTcgewogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIi4vYXNzZXRzL2ljb25zL2RyYXcvNy5wbmciKTsKICAgICAgYmFja2dyb3VuZC1zaXplOiA4MCU7CiAgICB9CiAgICAuaWNvbi1kZWwgewogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIi4vYXNzZXRzL2ljb25zL2RyYXcvZGVsLnBuZyIpOwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDkwJTsKICAgIH0KICAgIC5pY29uLWltZyB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi9hc3NldHMvaWNvbnMvZHJhdy9pbWcucG5nIik7CiAgICAgIGJhY2tncm91bmQtc2l6ZTogODAlOwogICAgfQogICAgLmljb24tYmFjayB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi9hc3NldHMvaWNvbnMvZHJhdy9iYWNrLnBuZyIpOwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDc1JTsKICAgIH0KICAgIC5pY29uLXNhdmUgewogICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoIi4vYXNzZXRzL2ljb25zL2RyYXcvc2F2ZS5wbmciKTsKICAgICAgYmFja2dyb3VuZC1zaXplOiA4MCU7CiAgICB9CiAgICAuaWNvbi1tb3VzZSB7CiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiLi9hc3NldHMvaWNvbnMvZHJhdy9tb3VzZS5wbmciKTsKICAgICAgYmFja2dyb3VuZC1zaXplOiA2MCU7CiAgICB9CiAgfQogIC5hY3RpdmUgewogICAgYmFja2dyb3VuZDogI2VlZTsKICB9Cn0K"},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmlBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div class=\"maintenancePlanAdd\">\n    <div class=\"child-panel-title\">\n      <h2>图形标注</h2>\n    </div>\n    <div class=\"panel-body\">\n      <div class=\"demo\">\n        <canvas id=\"canvas\" :width=\"width\" :height=\"height\"></canvas>\n        <div class=\"draw-btn-group\">\n          <div :class=\"{active:drawType==''}\" title=\"自由选择\" @click=\"drawTypeChange('')\">\n            <i class=\"draw-icon icon-mouse\"></i>\n          </div>\n          <div :class=\"{active:drawType=='arrow'}\" title=\"画箭头\" @click=\"drawTypeChange('arrow')\">\n            <i class=\"draw-icon icon-1\"></i>\n          </div>\n          <div :class=\"{active:drawType=='text'}\" title=\"文本输入框\" @click=\"drawTypeChange('text')\">\n            <i class=\"draw-icon icon-2\"></i>\n          </div>\n          <div :class=\"{active:drawType=='ellipse'}\" title=\"画圆\" @click=\"drawTypeChange('ellipse')\">\n            <i class=\"draw-icon icon-3\"></i>\n          </div>\n          <div :class=\"{active:drawType=='rectangle'}\" title=\"画矩形\" @click=\"drawTypeChange('rectangle')\">\n            <i class=\"draw-icon icon-4\"></i>\n          </div>\n          <div :class=\"{active:drawType=='polygon'}\" title=\"画多边形\" @click=\"drawPolygon\">\n            <i class=\"draw-icon icon-6\"></i>\n          </div>\n          <div :class=\"{active:drawType=='pen'}\" title=\"笔画\" @click=\"drawTypeChange('pen')\">\n            <i class=\"draw-icon icon-7\"></i>\n          </div>\n          <div :class=\"{active:drawType=='pentagram'}\" title=\"五角星\" @click=\"drawTypeChange('pentagram')\">\n            <i class=\"draw-icon icon-pentagram\"></i>\n          </div>\n          <div @click=\"uploadImg\" title=\"从文件选择图片上传\">\n            <i class=\"draw-icon icon-img\"></i>\n          </div>\n          <div @click=\"loadExpImg\" title=\"加载背景图\">\n            <i class=\"draw-icon icon-back\"></i>\n          </div>\n          <div @click=\"save\" title=\"保存\">\n            <i class=\"draw-icon icon-save\"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n    <input type=\"file\" @change=\"uploadImgChange\" id=\"imgInput\" accept=\"image/*\" />\n    <img id=\"img\" :src=\"imgSrc\" />\n    <img id=\"expImg\" src=\"./assets/icons/draw/exp.jpg\" />\n  </div>\n</template>\n<script>\nexport default {\n  name: \"App\",\n  data() {\n    return {\n      width: 1280,\n      height: 720,\n      rect: [],\n      canvas: {},\n      showMenu: false,\n      x: \"\",\n      y: \"\",\n      mouseFrom: {},\n      mouseTo: {},\n      drawType: null,  //当前绘制图像的种类\n      canvasObjectIndex: 0,\n      textbox: null,\n      rectangleLabel: \"warning\",\n      drawWidth: 2, //笔触宽度\n      color: \"#E34F51\", //画笔颜色\n      drawingObject: null, //当前绘制对象\n      moveCount: 1, //绘制移动计数器\n      doDrawing: false, // 绘制状态\n      //polygon 相关参数\n      polygonMode: false,\n      pointArray: [],\n      lineArray: [],\n      activeShape: false,\n      activeLine: \"\",\n      line: {},\n      delectKlass: {},\n      imgFile: {},\n      imgSrc: \"\",\n    };\n  },\n  watch: {\n    drawType() {\n      this.canvas.selection = !this.drawType;\n    },\n    width() {\n      this.canvas.setWidth(this.width)\n    },\n    height() {\n      this.canvas.setHeight(this.height)\n    },\n  },\n  methods: {\n    // 保存当前画布为png图片\n    save() {\n      var canvas = document.getElementById('canvas')\n      var imgData = canvas.toDataURL('png');\n      imgData = imgData.replace('image/png', 'image/octet-stream');\n      // 下载后的问题名，可自由指定\n      var filename = 'drawingboard_' + (new Date()).getTime() + '.' + 'png';\n      this.saveFile(imgData, filename);\n    },\n    saveFile(data, filename) {\n      var save_link = document.createElement('a');\n      save_link.href = data;\n      save_link.download = filename;\n      var event = document.createEvent('MouseEvents');\n      event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n      save_link.dispatchEvent(event);\n    },\n    uploadImg() {\n      document.getElementById(\"imgInput\").click();\n    },\n    // 从已渲染的DOM元素加载图片至canvas\n    loadExpImg() {\n      var imgElement = document.getElementById(\"expImg\"); //声明我们的图片\n      var imgInstance = new fabric.Image(imgElement, {\n        selectable: false\n        // zIndex:-99,\n      });\n      this.canvas.add(imgInstance);\n    },\n    // 从文件加载图片至canvas\n    uploadImgChange() {\n      // 获取文件\n      var eleImportInput = document.getElementById(\"imgInput\");\n      this.imgFile = eleImportInput.files[0];\n      var imgSrc = \"\",\n          imgTitle = \"\";\n      // 从reader中获取选择文件的src\n      if (/\\.(jpe?g|png|gif)$/i.test(this.imgFile.name)) {\n        var reader = new FileReader();\n        var _this = this;\n        reader.addEventListener(\n            \"load\",\n            function () {\n              imgTitle = _this.imgFile.name;\n              _this.imgSrc = this.result;\n            },\n            false\n        );\n        reader.readAsDataURL(this.imgFile);\n      }\n      var imgElement = document.getElementById(\"img\"); //声明我们的图片\n      imgElement.onload = () => {\n        this.width = imgElement.width\n        this.height = imgElement.height\n        var imgInstance = new fabric.Image(imgElement, {\n          zIndex: -1,\n          selectable: false\n        });\n        this.canvas.add(imgInstance);\n      };\n    },\n    // 开始绘制时，指定绘画种类\n    drawTypeChange(e) {\n      this.drawType = e;\n      this.canvas.skipTargetFind = !!e\n      if (e == \"pen\") {\n        // isDrawingMode为true 才可以自由绘画\n        this.canvas.isDrawingMode = true;\n      } else {\n        this.canvas.isDrawingMode = false;\n      }\n    },\n    // 鼠标按下时触发\n    mousedown(e) {\n      // 记录鼠标按下时的坐标\n      var xy = e.pointer || this.transformMouse(e.e.offsetX, e.e.offsetY);\n      this.mouseFrom.x = xy.x;\n      this.mouseFrom.y = xy.y;\n      this.doDrawing = true;\n      if (this.drawType == \"text\") {\n        this.drawing();\n      }\n      if (this.textbox) {\n        this.textbox.enterEditing();\n        this.textbox.hiddenTextarea.focus();\n      }\n      // 绘制多边形\n      if (this.drawType == \"polygon\") {\n        this.canvas.skipTargetFind = false;\n        try {\n          // 此段为判断是否闭合多边形，点击红点时闭合多边形\n          if (this.pointArray.length > 1) {\n            // e.target.id == this.pointArray[0].id 表示点击了初始红点\n            if (e.target && e.target.id == this.pointArray[0].id) {\n              this.generatePolygon();\n            }\n          }\n          //未点击红点则继续作画\n          if (this.polygonMode) {\n            this.addPoint(e);\n          }\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    },\n    // 鼠标松开执行\n    mouseup(e) {\n      var xy = e.pointer || this.transformMouse(e.e.offsetX, e.e.offsetY);\n      this.mouseTo.x = xy.x;\n      this.mouseTo.y = xy.y;\n      this.drawingObject = null;\n      this.moveCount = 1;\n      if (this.drawType != \"polygon\") {\n        this.doDrawing = false;\n      }\n    },\n    //鼠标移动过程中已经完成了绘制\n    mousemove(e) {\n      if (this.moveCount % 2 && !this.doDrawing) {\n        //减少绘制频率\n        return;\n      }\n      this.moveCount++;\n      var xy = e.pointer || this.transformMouse(e.e.offsetX, e.e.offsetY);\n      this.mouseTo.x = xy.x;\n      this.mouseTo.y = xy.y;\n      // 多边形与文字框特殊处理\n      if (this.drawType != \"text\" || this.drawType != \"polygon\") {\n        this.drawing(e);\n      }\n      if (this.drawType == \"polygon\") {\n        if (this.activeLine && this.activeLine.class == \"line\") {\n          var pointer = this.canvas.getPointer(e.e);\n          this.activeLine.set({ x2: pointer.x, y2: pointer.y });\n          var points = this.activeShape.get(\"points\");\n          points[this.pointArray.length] = {\n            x: pointer.x,\n            y: pointer.y,\n            zIndex: 1\n          };\n          this.activeShape.set({\n            points: points\n          });\n          this.canvas.renderAll();\n        }\n        this.canvas.renderAll();\n      }\n    },\n    deleteObj() {\n      this.canvas.getActiveObjects().map(item => {\n        this.canvas.remove(item);\n      });\n    },\n    transformMouse(mouseX, mouseY) {\n      return { x: mouseX / 1, y: mouseY / 1 };\n    },\n    // 绘制多边形开始，绘制多边形和其他图形不一样，需要单独处理\n    drawPolygon() {\n      this.drawType = \"polygon\";\n      this.polygonMode = true;\n      //这里画的多边形，由顶点与线组成\n      this.pointArray = new Array();  // 顶点集合\n      this.lineArray = new Array();  //线集合\n      this.canvas.isDrawingMode = false;\n    },\n    addPoint(e) {\n      var random = Math.floor(Math.random() * 10000);\n      var id = new Date().getTime() + random;\n      var circle = new fabric.Circle({\n        radius: 5,\n        fill: \"#ffffff\",\n        stroke: \"#333333\",\n        strokeWidth: 0.5,\n        left: (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\n        top: (e.pointer.y || e.e.layerY) / this.canvas.getZoom(),\n        selectable: false,\n        hasBorders: false,\n        hasControls: false,\n        originX: \"center\",\n        originY: \"center\",\n        id: id,\n        objectCaching: false\n      });\n      if (this.pointArray.length == 0) {\n        circle.set({\n          fill: \"red\"\n        });\n      }\n      var points = [\n        (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\n        (e.pointer.y || e.e.layerY) / this.canvas.getZoom(),\n        (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\n        (e.pointer.y || e.e.layerY) / this.canvas.getZoom()\n      ];\n      this.line = new fabric.Line(points, {\n        strokeWidth: 2,\n        fill: \"#999999\",\n        stroke: \"#999999\",\n        class: \"line\",\n        originX: \"center\",\n        originY: \"center\",\n        selectable: false,\n        hasBorders: false,\n        hasControls: false,\n        evented: false,\n        objectCaching: false\n      });\n      if (this.activeShape) {\n        var pos = this.canvas.getPointer(e.e);\n        var points = this.activeShape.get(\"points\");\n        points.push({\n          x: pos.x,\n          y: pos.y\n        });\n        var polygon = new fabric.Polygon(points, {\n          stroke: \"#333333\",\n          strokeWidth: 1,\n          fill: \"#cccccc\",\n          opacity: 0.3,\n          selectable: false,\n          hasBorders: false,\n          hasControls: false,\n          evented: false,\n          objectCaching: false\n        });\n        this.canvas.remove(this.activeShape);\n        this.canvas.add(polygon);\n        this.activeShape = polygon;\n        this.canvas.renderAll();\n      } else {\n        var polyPoint = [\n          {\n            x: (e.pointer.x || e.e.layerX) / this.canvas.getZoom(),\n            y: (e.pointer.y || e.e.layerY) / this.canvas.getZoom()\n          }\n        ];\n        var polygon = new fabric.Polygon(polyPoint, {\n          stroke: \"#333333\",\n          strokeWidth: 1,\n          fill: \"#cccccc\",\n          opacity: 0.3,\n          selectable: false,\n          hasBorders: false,\n          hasControls: false,\n          evented: false,\n          objectCaching: false\n        });\n        this.activeShape = polygon;\n        this.canvas.add(polygon);\n      }\n      this.activeLine = this.line;\n      this.pointArray.push(circle);\n      this.lineArray.push(this.line);\n      this.canvas.add(this.line);\n      this.canvas.add(circle);\n    },\n    generatePolygon() {\n      var points = new Array();\n      this.pointArray.map((point, index) => {\n        points.push({\n          x: point.left,\n          y: point.top\n        });\n        this.canvas.remove(point);\n      });\n      this.lineArray.map((line, index) => {\n        this.canvas.remove(line);\n      });\n      this.canvas.remove(this.activeShape).remove(this.activeLine);\n      var polygon = new fabric.Polygon(points, {\n        stroke: this.color,\n        strokeWidth: this.drawWidth,\n        fill: \"rgba(255, 255, 255, 0)\",\n        opacity: 1,\n        hasBorders: true,\n        hasControls: false\n      });\n      this.canvas.add(polygon);\n      this.activeLine = null;\n      this.activeShape = null;\n      this.polygonMode = false;\n      this.doDrawing = false;\n      this.drawType = null;\n    },\n    drawing(e) {\n      if (this.drawingObject) {\n        this.canvas.remove(this.drawingObject);\n      }\n      var canvasObject = null;\n      var left = this.mouseFrom.x,\n          top = this.mouseFrom.y,\n          mouseFrom = this.mouseFrom,\n          mouseTo = this.mouseTo;\n      switch (this.drawType) {\n        case \"arrow\": //箭头\n          var x1 = mouseFrom.x,\n              x2 = mouseTo.x,\n              y1 = mouseFrom.y,\n              y2 = mouseTo.y;\n          var w = x2 - x1,\n              h = y2 - y1,\n              sh = Math.cos(Math.PI / 4) * 16;\n          var sin = h / Math.sqrt(Math.pow(w, 2) + Math.pow(h, 2));\n          var cos = w / Math.sqrt(Math.pow(w, 2) + Math.pow(h, 2));\n          var w1 = (16 * sin) / 4,\n              h1 = (16 * cos) / 4,\n              centerx = sh * cos,\n              centery = sh * sin;\n          /**\n           * centerx,centery 表示起始点，终点连线与箭头尖端等边三角形交点相对x，y\n           * w1 ，h1用于确定四个点\n           */\n          var path = \" M \" + x1 + \" \" + y1;\n          path += \" L \" + (x2 - centerx + w1) + \" \" + (y2 - centery - h1);\n          path +=\n              \" L \" + (x2 - centerx + w1 * 2) + \" \" + (y2 - centery - h1 * 2);\n          path += \" L \" + x2 + \" \" + y2;\n          path +=\n              \" L \" + (x2 - centerx - w1 * 2) + \" \" + (y2 - centery + h1 * 2);\n          path += \" L \" + (x2 - centerx - w1) + \" \" + (y2 - centery + h1);\n          path += \" Z\";\n          canvasObject = new fabric.Path(path, {\n            stroke: this.color,\n            fill: this.color,\n            strokeWidth: this.drawWidth\n          });\n          break;\n        case \"pentagram\": //五角星\n          var x1 = mouseFrom.x,\n              x2 = mouseTo.x,\n              y1 = mouseFrom.y,\n              y2 = mouseTo.y;\n          /**\n           * 实现思路  (x1,y1)表示鼠标起始的位置 (x2,y2)表示鼠标抬起的位置\n           * r 表示五边形外圈圆的半径，这里建议自己画个图理解\n           * 正五边形夹角为36度。计算出cos18°，sin18°备用\n           */\n          var w = Math.abs(x2 - x1),\n              h = Math.abs(y2 - y1),\n              r = Math.sqrt(w * w + h * h)\n          var cos18 = Math.cos(18 * Math.PI / 180)\n          var sin18 = Math.sin(18 * Math.PI / 180)\n          /**\n           * 算出对应五个点的坐标转化为路径\n           */\n          var point1 = [x1, y1 + r]\n          var point2 = [x1 + 2 * r * (sin18), y1 + r - 2 * r * (cos18)]\n          var point3 = [x1 - r * (cos18), y1 + r * (sin18)]\n          var point4 = [x1 + r * (cos18), y1 + r * (sin18)]\n          var point5 = [x1 - 2 * r * (sin18), y1 + r - 2 * r * (cos18)]\n          var path = \" M \" + point1[0] + \" \" + point1[1]\n          path += \" L \" + point2[0] + \" \" + point2[1]\n          path += \" L \" + point3[0] + \" \" + point3[1]\n          path += \" L \" + point4[0] + \" \" + point4[1]\n          path += \" L \" + point5[0] + \" \" + point5[1]\n          path += \" Z\";\n          canvasObject = new fabric.Path(path, {\n            stroke: this.color,\n            fill: this.color,\n            strokeWidth: this.drawWidth,\n            // angle:180,  //设置旋转角度\n          });\n          break;\n        case \"ellipse\": //椭圆\n          // 按shift时画正圆，只有在鼠标移动时才执行这个，所以按了shift但是没有拖动鼠标将不会画圆\n          if (e.e.shiftKey) {\n            mouseTo.x - left > mouseTo.y - top ? mouseTo.y = top + mouseTo.x - left : mouseTo.x = left + mouseTo.y - top\n          }\n          var radius =\n              Math.sqrt(\n                  (mouseTo.x - left) * (mouseTo.x - left) +\n                  (mouseTo.y - top) * (mouseTo.y - top)\n              ) / 2;\n          canvasObject = new fabric.Ellipse({\n            left: (mouseTo.x - left) / 2 + left,\n            top: (mouseTo.y - top) / 2 + top,\n            stroke: this.color,\n            fill: \"rgba(255, 255, 255, 0)\",\n            originX: \"center\",\n            originY: \"center\",\n            rx: Math.abs(left - mouseTo.x) / 2,\n            ry: Math.abs(top - mouseTo.y) / 2,\n            strokeWidth: this.drawWidth\n          });\n          break;\n        case \"rectangle\": //长方形\n          // 按shift时画正方型\n          if (e.e.shiftKey) {\n            mouseTo.x - left > mouseTo.y - top ? mouseTo.y = top + mouseTo.x - left : mouseTo.x = left + mouseTo.y - top\n          }\n          var path =\n              \"M \" +\n              mouseFrom.x +\n              \" \" +\n              mouseFrom.y +\n              \" L \" +\n              mouseTo.x +\n              \" \" +\n              mouseFrom.y +\n              \" L \" +\n              mouseTo.x +\n              \" \" +\n              mouseTo.y +\n              \" L \" +\n              mouseFrom.x +\n              \" \" +\n              mouseTo.y +\n              \" L \" +\n              mouseFrom.x +\n              \" \" +\n              mouseFrom.y +\n              \" z\";\n          canvasObject = new fabric.Path(path, {\n            left: left,\n            top: top,\n            stroke: this.color,\n            strokeWidth: this.drawWidth,\n            fill: \"rgba(255, 255, 255, 0)\",\n            hasControls: false\n          });\n          //也可以使用fabric.Rect\n          break;\n        case \"text\": //文本框\n          this.textbox = new fabric.Textbox(\"\", {\n            left: mouseFrom.x,\n            top: mouseFrom.y - 10,\n            // width: 150,\n            fontSize: 16,\n            borderColor: this.color,\n            fill: this.color,\n            hasControls: false\n          });\n          this.canvas.add(this.textbox);\n          this.textbox.enterEditing();\n          this.textbox.hiddenTextarea.focus();\n          break;\n        default:\n          break;\n      }\n      if (canvasObject) {\n        // canvasObject.index = getCanvasObjectIndex();\\\n        this.canvas.add(canvasObject); //.setActiveObject(canvasObject)\n        this.drawingObject = canvasObject;\n      }\n    }\n  },\n  mounted() {\n    this.canvas = new fabric.Canvas(\"canvas\", {\n      // skipTargetFind: false, //当为真时，跳过目标检测。目标检测将返回始终未定义。点击选择将无效\n      // selectable: false,  //为false时，不能选择对象进行修改\n      // selection: false   // 是否可以多个对象为一组\n    });\n    this.canvas.selectionColor = \"rgba(0,0,0,0.05)\";\n    this.canvas.on(\"mouse:down\", this.mousedown);\n    this.canvas.on(\"mouse:move\", this.mousemove);\n    this.canvas.on(\"mouse:up\", this.mouseup);\n    document.onkeydown = e => {\n      // 键盘 delect删除所选元素\n      if (e.keyCode == 46) {\n        this.deleteObj();\n      }\n      // ctrl+z 删除最近添加的元素\n      if (e.keyCode == 90 && e.ctrlKey) {\n        this.canvas.remove(\n            this.canvas.getObjects()[this.canvas.getObjects().length - 1]\n        );\n      }\n    };\n    // var originalRender = fabric.Textbox.prototype._render;\n    // fabric.Textbox.prototype._render = function(ctx) {\n    //   originalRender.call(this, ctx);\n    //   //Don't draw border if it is active(selected/ editing mode)\n    //   if (this.active) return;\n    //   if(this.showTextBoxBorder){\n    //     var w = this.width,\n    //       h = this.height,\n    //       x = -this.width / 2,\n    //       y = -this.height / 2;\n    //     ctx.beginPath();\n    //     ctx.moveTo(x, y);\n    //     ctx.lineTo(x + w, y);\n    //     ctx.lineTo(x + w, y + h);\n    //     ctx.lineTo(x, y + h);\n    //     ctx.lineTo(x, y);\n    //     ctx.closePath();\n    //     var stroke = ctx.strokeStyle;\n    //     ctx.strokeStyle = this.textboxBorderColor;\n    //     ctx.stroke();\n    //     ctx.strokeStyle = stroke;\n    //   }\n    // }\n    // fabric.Textbox.prototype.cacheProperties = fabric.Textbox.prototype.cacheProperties.concat('active');\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.el-container {\n  flex-direction: column;\n}\nimg,\ninput {\n  display: none;\n}\n.demo {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\ncanvas {\n  border: 1px dashed black;\n}\n.draw-btn-group {\n  // width: 1270px;\n  margin-top: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  & > div {\n    background: #fafafa;\n    cursor: pointer;\n    &:hover {\n      background: #eee;\n    }\n    i {\n      display: flex;\n      background-repeat: no-repeat;\n      background-size: 80%;\n      background-position: 50% 50%;\n      height: 30px;\n      width: 30px;\n    }\n    .icon-1 {\n      background-image: url(\"./assets/icons/draw/1.png\");\n    }\n    .icon-pentagram {\n      background-image: url(\"./assets/icons/draw/pentagram.png\");\n    }\n    .icon-2 {\n      background-image: url(\"./assets/icons/draw/2.png\");\n    }\n    .icon-3 {\n      background-image: url(\"./assets/icons/draw/3.png\");\n    }\n    .icon-4 {\n      background-image: url(\"./assets/icons/draw/4.png\");\n      background-size: 75%;\n    }\n    .icon-5 {\n      background-image: url(\"./assets/icons/draw/5.png\");\n      background-size: 70%;\n    }\n    .icon-6 {\n      background-image: url(\"./assets/icons/draw/6.png\");\n    }\n    .icon-7 {\n      background-image: url(\"./assets/icons/draw/7.png\");\n      background-size: 80%;\n    }\n    .icon-del {\n      background-image: url(\"./assets/icons/draw/del.png\");\n      background-size: 90%;\n    }\n    .icon-img {\n      background-image: url(\"./assets/icons/draw/img.png\");\n      background-size: 80%;\n    }\n    .icon-back {\n      background-image: url(\"./assets/icons/draw/back.png\");\n      background-size: 75%;\n    }\n    .icon-save {\n      background-image: url(\"./assets/icons/draw/save.png\");\n      background-size: 80%;\n    }\n    .icon-mouse {\n      background-image: url(\"./assets/icons/draw/mouse.png\");\n      background-size: 60%;\n    }\n  }\n  .active {\n    background: #eee;\n  }\n}\n</style>"]}]}